# 스테이트풀 스토리지 선택 (Stateful Storage Selection)

## 정의

쿠버네티스에서 상태가 있는 애플리케이션을 운영할 때, 퍼시스턴트볼륨의 저장 방식(파일/블록)과 운영 모델(직접 운영/관리형 서비스)을 요구사항에 맞게 선택하는 원칙.

## 왜 중요한가?

- 스테이트풀 서비스는 백업, 복구, 데이터 로컬리티, 리던던시 등 운영 난도가 높다.
- 잘못된 스토리지 선택은 성능 저하와 운영 비용 증가로 바로 이어진다.
- 상태 관리 설계가 약하면 클러스터 간 이전, 장애 복구가 매우 어려워진다.

## 책 내용 핵심 정리

- 퍼시스턴트볼륨은 NFS, SMB 같은 파일 기반 네트워크 스토리지 또는 iSCSI/클라우드 디스크 같은 블록 스토리지를 사용할 수 있다.
- 데이터베이스처럼 성능이 중요한 워크로드는 블록 스토리지가 더 유리한 경우가 많다.
- 유연성이 필요한 경우에는 파일 기반 스토리지가 더 적합할 수 있다.
- 상태 관리는 본질적으로 복잡하므로, 가능하면 MySQL/Redis 같은 관리형 스테이트풀 SaaS 활용을 우선 고려하는 것이 현실적이다.
- 온프레미스처럼 SaaS 활용이 어려운 환경에서는 각 팀이 개별 구축하기보다 전담 플랫폼/스토리지 팀이 공통 서비스를 제공하는 방식이 효율적이다.

## 실무 포인트

### 1. 워크로드 특성 기반 스토리지 선택
- IOPS/지연시간 민감 워크로드(DB, 큐)는 블록 스토리지를 우선 검토한다.
- 공유 파일, 유연한 마운트 구조가 필요한 워크로드는 파일 스토리지를 우선 검토한다.

### 2. 상태 관리 운영 책임 분리
- 애플리케이션 팀이 비즈니스 로직에 집중하도록 상태 저장소 운영을 분리한다.
- 가능하면 관리형 DB/캐시를 사용하고, 불가하면 플랫폼 팀이 표준 스토리지 서비스를 제공한다.

### 3. 복구 가능성 중심으로 설계
- 백업 주기, 복구 목표(RTO/RPO), 복제 정책을 배포 전 명시한다.
- 스냅샷/복구 리허설을 정기적으로 수행해 문서화한다.

### 4. 데이터 이동성 고려
- 클러스터/리전 이전 가능성을 초기부터 고려한다.
- 저장소 종속 기능을 최소화해 마이그레이션 비용을 줄인다.

## 바로 적용 가능한 체크리스트

- [ ] 워크로드별로 파일/블록 스토리지 선택 기준 문서화
- [ ] 상태 저장소의 RTO/RPO와 백업 정책 합의
- [ ] 복구 리허설(백업 복원, 장애 전환) 정기 실행
- [ ] SaaS 우선, 불가 시 플랫폼 팀 표준 서비스 사용
- [ ] 팀별 개별 운영 대신 공통 운영 모델 수립

## 실무 한 줄

스테이트풀 운영의 핵심은 "어떤 볼륨을 붙일까"가 아니라, **성능 요구와 운영 책임을 분리해 복구 가능한 구조를 만드는 것**이다.

## 관련 개념

- 퍼시스턴트볼륨 (PV/PVC)
- StatefulSet
- 데이터 로컬리티 / 리던던시
- 백업/복구 전략 (RTO/RPO)

## 출처

- 쿠버네티스 창시자에게 배우는 모범 사례 2판
